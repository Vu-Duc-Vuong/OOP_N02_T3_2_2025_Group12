<!-- Form thêm/sửa phiếu nhập -->
<div class="row">
    <div class="col-md-8 mx-auto">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-plus-circle" th:if="${action == 'add'}"></i>
                    <i class="fas fa-edit" th:if="${action == 'edit'}"></i>
                    <span th:text="${action == 'add' ? 'Thêm Phiếu Nhập Mới' : 'Sửa Phiếu Nhập'}">Thêm Phiếu Nhập Mới</span>
                </h5>
            </div>
            <div class="card-body">
                <form th:action="${action == 'add' ? '/quanly/nhap/add' : '/quanly/nhap/edit/' + index}" 
                      th:object="${nhap}" method="post">
                    
                    <!-- Mã Hàng Hóa -->
                    <div class="mb-3">
                        <label for="hanghoaID" class="form-label">
                            <i class="fas fa-barcode"></i> Mã Hàng Hóa <span class="text-danger">*</span>
                        </label>
                        <input type="text" class="form-control" id="hanghoaID" 
                               th:field="*{hanghoaID}" required
                               placeholder="Nhập mã hàng hóa (VD: HH001)"
                               th:readonly="${action == 'edit'}">
                    </div>
                    <!-- Tên Hàng -->
                    <div class="mb-3">
                        <label for="tenHang" class="form-label">
                            <i class="fas fa-box"></i> Tên Hàng <span class="text-danger">*</span>
                        </label>
                        <input type="text" class="form-control" id="tenHang" 
                               th:field="*{tenHang}" required
                               placeholder="Nhập tên hàng (VD: Gạo ST25)">
                    </div>
                    
                    <!-- Số Lượng Nhập -->
                    <div class="mb-3">
                        <label for="soLuongNhap" class="form-label">
                            <i class="fas fa-cubes"></i> Số Lượng Nhập <span class="text-danger">*</span>
                        </label>
                        <input type="number" class="form-control" id="soLuongNhap" 
                               th:field="*{soLuongNhap}" required min="1"
                               placeholder="Nhập số lượng">
                    </div>
                    
                    <!-- Giá Nhập với định dạng nghìn -->
                    <div class="mb-3">
                        <label class="form-label">
                            <i class="fas fa-money-bill"></i> Giá Nhập (VNĐ) <span class="text-danger">*</span>
                        </label>
                        <!-- Trường hiển thị định dạng 1.000 -->
                        <input type="text" class="form-control" id="giaNhapDisplay" placeholder="VD: 100.000" inputmode="numeric" autocomplete="off" required>
                        <!-- Trường ẩn submit giá trị số -->
                        <input type="hidden" th:field="*{giaNhap}" id="giaNhap" />
                    </div>
                    
                    <!-- Thời Gian Nhập (mới bổ sung) -->
                    <div class="mb-3">
                        <label for="thoiGianNhap" class="form-label">
                            <i class="fas fa-clock"></i> Thời Gian Nhập
                        </label>
                        <input type="datetime-local" class="form-control" id="thoiGianNhap"
                               th:field="*{thoiGianNhap}" />
                        <div class="form-text">Nếu để trống sẽ lấy thời điểm hiện tại.</div>
                    </div>

                    <!-- Bỏ trường Ngày Nhập riêng lẻ; model tự set & đồng bộ với thời gian chi tiết -->
                    
                    <!-- Buttons -->
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <a href="/quanly/nhap" class="btn btn-secondary me-md-2">
                            <i class="fas fa-times"></i> Hủy
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i>
                            <span th:text="${action == 'add' ? 'Thêm Phiếu Nhập' : 'Cập Nhật'}">Thêm Phiếu Nhập</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
></div>

<!-- Script định dạng giá nhập -->
<script>
document.addEventListener('DOMContentLoaded', function(){
    const giaNhapHidden = document.getElementById('giaNhap');
    const giaNhapDisplay = document.getElementById('giaNhapDisplay');
    const soLuong = document.getElementById('soLuongNhap');

    function formatNumber(v){
        if(v === '' || v == null) return '';
        const num = Number(v.toString().replace(/\D/g,''));
        if(isNaN(num)) return '';
        return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
    }
    if(giaNhapHidden.value){
        giaNhapDisplay.value = formatNumber(giaNhapHidden.value);
    }
    giaNhapDisplay.addEventListener('input', function(){
        const numeric = this.value.replace(/\D/g,'');
        giaNhapHidden.value = numeric;
        this.value = formatNumber(numeric);
    });
});
</script>

<!-- Đã xóa script tự động set Ngày Nhập theo yêu cầu -->
