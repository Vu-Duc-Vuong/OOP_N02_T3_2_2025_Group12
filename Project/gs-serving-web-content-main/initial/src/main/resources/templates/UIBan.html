<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Danh Sách Bán Hàng</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        :root {
            --primary:#3B82F6; /* xanh dương nhạt */
            --primary-hover:#2563EB;
            --success:#10B981; /* xanh lá nút hành động */
            --danger:#EF4444;
            --warning:#F59E0B;
            --sale:#EF4444; /* đỏ nhạt bán hàng theo mapping */
            --bg:#F3F4F6; /* xám sáng */
            --card-bg:#FFFFFF;
            --text:#1F2937;
            --muted:#6B7280;
            --table-hover:#E0F2FE; /* xanh nhạt hover */
        }
        body{background:var(--bg);color:var(--text);font-family:'Segoe UI',Arial,sans-serif;}
        .navbar-brand{font-weight:600;}
        .navbar.bg-primary{background:var(--primary)!important;}
        .nav-link.active{background:rgba(255,255,255,.15);border-radius:6px;}
        .card{border:1px solid #e5e7eb;box-shadow:0 2px 4px rgba(0,0,0,.04);border-radius:12px;overflow:hidden;background:var(--card-bg);}        
        .card-header{background:linear-gradient(90deg,var(--primary),var(--primary-hover));color:#fff;padding:.85rem 1.25rem;}
    h2,h5{font-weight:600;}
    .text-sale{color:var(--sale)!important;}
    .btn-sale{background:var(--sale);border-color:var(--sale);color:#fff;}
    .btn-sale:hover{background:#ea580c;border-color:#ea580c;color:#fff;}
        .btn{border-radius:8px;font-weight:500;letter-spacing:.2px;}
        .btn-success{background:var(--success);border-color:var(--success);}        
        .btn-warning{background:var(--warning);border-color:var(--warning);color:#1F2937;}
        .btn-danger{background:var(--danger);border-color:var(--danger);}        
        .table{vertical-align:middle;}
        thead.table-dark{background:#1F2937!important;}
        .table-hover tbody tr:hover{background:var(--table-hover);}        
        .badge.bg-primary{background:var(--primary)!important;}
        .badge.bg-info{background:#0ea5e9!important;}
        .text-success{color:var(--success)!important;}
        footer{background:#1F2937;color:#F9FAFB;margin-top:70px;padding:24px 0;}
        /* Dark mode */
        .dark-mode body,body.dark-mode{--bg:#1F2937;--card-bg:#273345;--text:#F9FAFB;--muted:#9CA3AF;--table-hover:#334155;background:var(--bg);}
        body.dark-mode .card{border-color:#334155;}
        body.dark-mode .card-header{background:linear-gradient(90deg,#0f4ba8,#1d62c8);}        
        body.dark-mode .navbar.bg-primary{background:#1E3A8A!important;}
        body.dark-mode thead.table-dark{background:#0f172a!important;}
        .mode-toggle{position:fixed;right:16px;bottom:16px;z-index:999;}
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-store"></i> Quản Lý Cửa Hàng
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="/"><i class="fas fa-home"></i> Trang Chủ</a></li>
                    <li class="nav-item"><a class="nav-link" href="/hanghoa"><i class="fas fa-boxes"></i> Hàng Hóa</a></li>
                    <li class="nav-item"><a class="nav-link" href="/quanly/nhap"><i class="fas fa-truck"></i> Nhập Hàng</a></li>
                    <li class="nav-item"><a class="nav-link active" href="/ban"><i class="fas fa-cash-register"></i> Bán Hàng</a></li>
                    <li class="nav-item"><a class="nav-link" href="/doanhthu"><i class="fas fa-chart-line"></i> Doanh Thu</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col">
                <h2><i class="fas fa-shopping-cart text-sale"></i> Danh Sách Phiếu Bán Hàng</h2>
            </div>
        </div>

    <!-- Ban List (moved lên trên theo yêu cầu) -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-list"></i> Danh Sách Phiếu Bán Hàng
                </h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th><i class="fas fa-hashtag"></i> STT</th>
                                <th><i class="fas fa-file-alt"></i> Mã Phiếu</th>
                                <th><i class="fas fa-box"></i> Tên Hàng</th>
                                <th><i class="fas fa-user"></i> Tên Khách Hàng</th>
                                <th class="text-end"><i class="fas fa-sort-numeric-up"></i> Số Lượng</th>
                                <th class="text-end"><i class="fas fa-tag"></i> Đơn Giá (VNĐ)</th>
                                <th class="text-end"><i class="fas fa-clock"></i> Thời Gian Bán</th>
                                <th class="text-end"><i class="fas fa-calculator"></i> Tổng Tiền (VNĐ)</th>
                                <th class="text-center"><i class="fas fa-cogs"></i> Hành động</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="ban, iterStat : ${banList}">
                                <td th:text="${iterStat.count}">1</td>
                                <td><span class="badge bg-primary" th:text="${ban.maPhieu}">P001</span></td>
                                <td th:text="${ban.tenHang}">Gạo</td>
                                <td th:text="${ban.tenKhach}">Khách hàng</td>
                                <td class="text-end"><span class="badge bg-info" th:text="${ban.soLuong}">0</span></td>
                                <td class="text-end"><span th:text="${#numbers.formatDecimal(ban.donGia, 0, 'POINT', 0, 'COMMA')}">0</span></td>
                                <td class="text-end"><span class="badge bg-light text-dark" th:text="${#temporals.format(ban.thoiGianBan, 'dd/MM HH:mm')}">--</span></td>
                                <td class="text-end"><strong class="text-success"><span th:text="${#numbers.formatDecimal(ban.tongTien(), 0, 'POINT', 0, 'COMMA')}">0</span></strong></td>
                                <td>
                                    <a th:href="@{'/ban/edit/' + ${ban.maPhieu}}" class="btn btn-warning btn-sm"><i class="fas fa-edit"></i> Sửa</a>
                                    <a th:href="@{'/ban/delete/' + ${ban.maPhieu}}" class="btn btn-danger btn-sm" onclick="return confirm('Xác nhận xóa phiếu này?')"><i class="fas fa-trash"></i> Xóa</a>
                                </td>
                            </tr>
                        </tbody>
                        <tfoot class="table-light">
                            <tr>
                                <th colspan="7" class="text-end"><strong>TỔNG CỘNG:</strong></th>
                                <th class="text-success text-end"><strong><span th:text="${#numbers.formatDecimal(tongDoanhThu, 0, 'POINT', 0, 'COMMA')}">0</span></strong></th>
                                <th></th>
                            </tr>
                        </tfoot>
                    </table>
                </div>
                
                <!-- Empty State -->
                <div th:if="${#lists.isEmpty(banList)}" class="text-center py-5">
                    <i class="fas fa-shopping-cart fa-3x text-muted mb-3"></i>
                    <h5 class="text-muted">Chưa có phiếu bán nào</h5>
                </div>
            </div>
        </div>


        <!-- Action Buttons -->
        <div class="row mt-4">
            <div class="col">
                <a href="/" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Quay về Trang chủ
                </a>
                <a href="/ban/add" class="btn btn-sale">
                    <i class="fas fa-plus"></i> Thêm Phiếu Bán
                </a>
                <a href="/ban/stats" class="btn btn-info">
                    <i class="fas fa-chart-bar"></i> Thống Kê
                </a>
            </div>
        </div>
    </div>
    <!-- Footer thống nhất -->
    <footer class="text-center">
        <div class="container">
            <p>&copy; 2025 Nhóm 12 - OOP_N02_T3. Ứng dụng Quản Lý Cửa Hàng Tạp Hóa với Spring Boot</p>
            <p><strong>Thành viên:</strong> Vũ Đức Vượng (24100383) | Tưởng Văn Tuyên (24100462)</p>
        </div>
    </footer>

    <button class="btn btn-sm btn-dark mode-toggle" id="modeToggle" title="Chuyển chế độ sáng/tối">
        <i class="fas fa-moon"></i>
    </button>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const btn = document.getElementById('modeToggle');
        btn.addEventListener('click',()=>{
            document.body.classList.toggle('dark-mode');
            btn.innerHTML = document.body.classList.contains('dark-mode') ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
        });
    </script>
</body>
</html>
