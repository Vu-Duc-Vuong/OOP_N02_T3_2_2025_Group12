<style>
  /* Modern profit/loss highlighting */
  .kpi-card{border:1px solid #e5e7eb;border-radius:14px;box-shadow:0 2px 4px rgba(0,0,0,.05);overflow:hidden;background:#fff;}
  .kpi-card .card-body{padding:1.15rem 1.25rem;}
  .kpi-title{font-size:.9rem;font-weight:600;letter-spacing:.5px;text-transform:uppercase;margin-bottom:.35rem;color:#6B7280;display:flex;align-items:center;gap:.5rem;}
  .kpi-value{font-weight:700;font-size:1.75rem;margin:0;line-height:1.1;}
  /* Pastel profit green */
  .profit-value{color:#34D399;}
  .loss-value{color:#EF4444;}
  .even-value{color:#F59E0B;}
  .result-box{display:flex;flex-direction:column;justify-content:center;align-items:flex-start;height:100%;}
  .result-status{font-size:1.4rem;font-weight:700;display:flex;align-items:center;gap:.5rem;margin:.25rem 0 .5rem;}
  .result-status.profit{color:#34D399;}
  .result-status.loss{color:#EF4444;}
  .result-status.even{color:#F59E0B;}
  .amount-chip{padding:.35rem .65rem;border-radius:30px;font-weight:600;font-size:.9rem;}
  .amount-chip.profit{background:#ECFDF5;color:#047857;}
  .amount-chip.loss{background:#FEE2E2;color:#991B1B;}
  .amount-chip.even{background:#FEF3C7;color:#92400E;}
  .time-range{margin-top:4px;font-size:.8rem;color:#6B7280;}
  @media (max-width:767px){.kpi-value{font-size:1.4rem}}
</style>
<div class="row mb-4" style="margin-top:10px;">
  <div class="col-md-12">
  <h2><i class="fas fa-chart-line text-primary"></i> Doanh Thu</h2>
  <form class="row gy-2 gx-2 align-items-end" method="get" action="/doanhthu">
      <div class="col-md-3">
        <label class="form-label">Từ ngày</label>
        <input type="date" class="form-control" id="fromDate" th:value="${from != null ? #temporals.format(from,'yyyy-MM-dd') : ''}">
      </div>
      <div class="col-md-3">
        <label class="form-label">Đến ngày</label>
        <input type="date" class="form-control" id="toDate" th:value="${to != null ? #temporals.format(to,'yyyy-MM-dd') : ''}">
      </div>
  <input type="hidden" name="from" id="fromHidden">
  <input type="hidden" name="to" id="toHidden">
      <div class="col-md-2">
        <button class="btn btn-primary w-100" type="submit"><i class="fas fa-filter"></i> Lọc</button>
      </div>
      <div class="col-md-2">
        <a href="/doanhthu" class="btn btn-secondary w-100"><i class="fas fa-sync"></i> Hôm nay</a>
      </div>
    </form>
    <div class="mt-2 small text-muted" th:if="${from != null}">
  Khoảng: <span th:text="${from}"></span> → <span th:text="${to}"></span> (giờ)
    </div>
  </div>
</div>
<div class="row g-4">
  <div class="col-md-4">
    <div class="kpi-card h-100">
      <div class="card-body">
        <div class="kpi-title"><i class="fas fa-truck text-info"></i><span>Tổng Tiền Nhập</span></div>
        <p class="kpi-value text-info" th:text="${#numbers.formatDecimal(tongNhap,0,'POINT',0,'COMMA')} + ' VNĐ'">0 VNĐ</p>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="kpi-card h-100">
      <div class="card-body">
        <div class="kpi-title"><i class="fas fa-cash-register text-success"></i><span>Tổng Tiền Bán</span></div>
        <p class="kpi-value profit-value" th:text="${#numbers.formatDecimal(tongBan,0,'POINT',0,'COMMA')} + ' VNĐ'">0 VNĐ</p>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="kpi-card h-100">
      <div class="card-body result-box">
        <div class="kpi-title"><i class="fas fa-balance-scale text-warning"></i><span>Kết Quả</span></div>
        <div class="result-status" th:classappend=" ${resultClass}" th:text="${statusIcon + ' ' + trangThai}">⚖️ HÒA VỐN</div>
        <div class="amount-chip" th:classappend=" ${resultClass}" th:text="${#numbers.formatDecimal(laiLo,0,'POINT',0,'COMMA')} + ' VNĐ'">0 VNĐ</div>
      </div>
    </div>
  </div>
</div>

<script>
  // Chỉ dùng ngày: tạo khoảng full 24h từ 00:00 đến 23:59:59
  (function(){
    function buildStart(idDate){
      const d=document.getElementById(idDate).value;
      if(!d) return '';
      return d+'T00:00';
    }
    function buildEnd(idDate){
      const d=document.getElementById(idDate).value;
      if(!d) return '';
      return d+'T23:59';
    }
    function sync(){
  const f = buildStart('fromDate');
  const t = buildEnd('toDate');
      document.getElementById('fromHidden').value = f || '';
      document.getElementById('toHidden').value   = t || '';
      if(!f) document.getElementById('fromHidden').removeAttribute('name'); else document.getElementById('fromHidden').setAttribute('name','from');
      if(!t) document.getElementById('toHidden').removeAttribute('name'); else document.getElementById('toHidden').setAttribute('name','to');
    }
  document.querySelector('form[action="/doanhthu"]').addEventListener('submit',function(){sync();});
  })();
</script>

<!-- Spacer to push footer further down -->
<div style="height:120px"></div>
